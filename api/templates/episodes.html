{%extends "base.html" %}
{%block content%}
<title>AnimeTV | Watch Anime online for FREE</title>
        <meta name="description" content="{{title}}" />
        <meta property="og:image" content="{{url}}" />
<style>

    .watch{
        padding: 2px 0;
        font-size: 1.1rem;
        border-radius: 5px;
        border: 0.5px solid rgb(22, 125, 236);
        background-color: rgb(0, 85, 212);
        font-weight: bold;
        color: #fff;
        height: 40px;
        width: 44px;
    }
    
    .watch:hover{
        background: #000;
        transition: 0.4s ease-in-out;
    }
    
    .info a{
        margin: 6px;
    }

    @media(max-width: 1000px) {
        #video{
            width: 100%;
            
        }
    }

    #video{
        width: 1000px;
    }

    .active{
        background-color: #000;
    }

    .watched{
        background-color: rgb(1, 0, 49);
    }
    
    #currentEp{
      font-size: 1rem;
      text-align: center;
      line-height: 20px;
    }
    
    #currentEp span{
      color: #89DA00;
      font-weight: bolder;
      font-size: 1.1rem;
    }
    
    #ep{
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .eplist{
      height: 400px;
      overflow-y: auto;
      background: #F4F4F4;
      border: 4px solid #CACACA;
      border-top: none;
      border-top-left-radius: 0;
      border-top-right-radius: 0;
      width: 100%;
    }
    
    .inpselect{
      height: 0;
      display: flex;
      flex-direction: column;
      width: 200px;
      overflow: hidden;
      background: #1B1B1B;
      overflow-y: auto;
      transition: 250ms;
    }
    
    .showEpPages{
      height: 100%;
    }
    
    .inpselect span{
      width: 100%;
      height: 1.8rem;
      background: #232323;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bolder;
      font-size: 1.15rem;
      color: white;
      border: 3px solid #232323;
      border-bottom: 1px solid #bababa;
    }
    
    .options{
      width: 100%;
      height: 30px;
      background: #E9E9E9;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      border: 4px solid #CACACA;
      border-bottom: none;

    }
    
    .fa-sharp{
      position: relative;
      top: 2px;
      right: -3px;
    }
    
    .activeList{
      height: 100%;
      font-weight: bolder;
    }
    
    .openepmenue{
      border: none;
      background: #BEBEBE;
      color: #252525;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 200px;
      font-size: 1.2rem;
      font-weight: bolder;
    }
</style>
<link rel="stylesheet" href="{{  url_for('static', filename='css/anime.css') }}">
<link rel="stylesheet" href="{{  url_for('static', filename='css/ep.css')  }}">
<main id="main">

<div class="info" style="flex-direction:column;">
<div class="background"></div>
<section id="animePlayer" style="display: flex;align-items: center;justify-content:center">
    <iframe id="video" src="" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

</section>
<div id="ep">
    <br>
<div>
    <h5 id="currentEp">You are watching  <br> <span>Episode 1</span></h5>
</div>
<div>
  
</div>
</div>
<br>
<div class="options">
  <div class="showEpPages">
    <button class="openepmenue">
      <span class="activeList">000 - 100</span><i class="fa-sharp fa-solid fa-angle-down"></i>
    </button>
    <div class="inpselect">
    </div>
  </div>
  
</div>
    <div style="display: flex;flex-wrap: wrap;align-items: center;align-items: center;justify-content: center;max-width: 1000px;margin: auto;" class="eplist">
        {% for i in range(loopRange) %}
        
        <a style="display: none" onclick="startep('{{hostname}}/anime/episodes/{{ep[i]}}',{{i+1}})"><button class="watch"> {{i+1}} </button></a>
        
        {% endfor %}
    </div>
</div>

    
<br>



</main><br><br><br>
<script src="{{ url_for('static',filename='js/ep.js') }}"></script>
<script>
    let openepmenue = document.querySelector('.openepmenue');
    let opened = false;
    openepmenue.addEventListener('click', () => {
      if (opened == false) {
        inpselect.style.height = "100px";
        opened = true;
      }
      else if(opened == true) {
        inpselect.style.height = "0";
        opened = false;
      }
    
    });
    
    let inpselect = document.querySelector('.inpselect');
    let eplist = document.querySelectorAll('.eplist a');
    let epNo = eplist.length;
    let epPageNo = (Math.floor(epNo/100) + 1);
    let pageOption = document.querySelector('.options .inpselect');
    for (let i = 0; i < epPageNo; i++) {
      pageOption.innerHTML += '<span onclick="changeList('+i+')">'+`${100*i} - ${100*(i+1)}`+'</span>'
    }
    let optionsHtml = '';
  
  
  
  function changeList(y){
    eplist.forEach(e =>{
      let epBtnNo = parseInt(e.innerText);
      if(epBtnNo >= y*100 && epBtnNo < (y+1)*100){
        e.style.display = 'block';
      }else{
        e.style.display = 'none';
      } 
    })
  }



    
    let video = document.querySelector("#video");
    const base_anime_url = "https://api.jikan.moe/v4/anime/{{animeId}}";
    let epPerPage = 100;
    let animeId = "{{ animeId }}"
    
    localStorage.setItem(`${animeId}-1`, "1");
    let q = document.querySelector("#ep");
    // let nOfEp = {{loopRange}}

    let cover = document.querySelector(".black-cover");
    let Spinner = document.querySelector(".Spinner");
    
    startep('{{hostname}}/anime/episodes/{{ep[0]}}',1);
    function startep(url,epNo){
        Spinner.style.display = 'block';
        cover.style.display = "block";
        fetch(`${url}`)
        .then(res => res.json())
        .then(data => ep(data,epNo))
        .catch(err => console.warn(err));
    }

    function ep(data,epNo){
        video.src = data["embed_url"];
        Spinner.style.display = 'none';
        cover.style.display = "none";
        document.querySelector("#currentEp span").innerHTML = `Episode ${epNo}`;
    }

    let w = video.offsetWidth;
    video.style.height = `${w/1.8}px`;
    addEventListener('resize', (event) => {
        let w = video.offsetWidth;
        video.style.height = `${w/1.8}px`;
    });

    let btns = document.querySelectorAll(".watch");

btns.forEach(e => {
    e.addEventListener("click",()=>{
        e.style.background = "rgb(0, 12, 31)";
        e.style.borderColor="transparent"
        e.style.transition="0.4s";
        localStorage.setItem(`${animeId}-${e.innerHTML}`, e.innerHTML);
        
    });
    if (localStorage.getItem(`${animeId}-${e.innerHTML}`) == `${e.innerHTML}`){
        e.style.background = "rgb(10, 30, 100)";
        e.style.borderColor="transparent"
        e.style.transition="0.4s";
    }
});

</script>
<script src="{{ url_for('static', filename='js/anime.js') }}"></script>

{% endblock %}